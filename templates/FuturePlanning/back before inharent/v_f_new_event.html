<!DOCTYPE html>
{% extends "FuturePlanning/mybase.html" %}
{%block test%}{{family}}{%endblock%}
    {% block body_block%}




    <div id="dataContainer" class="container-xxl" style="margin-top:60px; ">
      <div id="dataRow" class="row">
        <div id="tenSlotsData" class="col-lg-10 boxy" >
          <div id="Family Info" class="row">
            <div class="col-lg-12 boxy" >
              <div>
                  <h1 style="display:inline;">*********************תיכנון ארוע עתידי**********************     </h1><br>
                  <h1 style="display:inline;">בחר תקופת זמן להצגה             </h1>
                <!-- <h3 style="display:inline;color:blue;">מכפלות:</h3> -->
                <!-- <select id="periodSelect" onchange="periodChangeFunction()">
                    <h3 >
                      <option selected="selected" value=1>1</option>
                      <option value=2>2</option>
                      <option value=3>3</option>
                      <option value=4>4</option>
                      <option value=5>5</option>
                      <option value=6>6</option>
                      <option value=7>7</option>
                      <option value=8>8</option>
                      <option value=9>9</option>
                      <option value=10>10</option>
                      <option value=11>11</option>
                      <option value=12>12</option>
                    </h3>
                  </select> -->
                  <h3 style="display:inline;color:blue;">תקופה:</h3>
                  <select id="typeOfPeriods" onchange="periodChangeFunction()">
                    <h3 >
                      <option  selected value=1>חודש</option>
                      <option   value=12>שנה</option>
                    </h3>
                  </select>
                  <h3 style="display:inline;color:blue;">מספר תקופות:</h3>










                <select id="returns" onchange="periodChangeFunction()">
                  <h3 >
                    <option value=1>1</option>
                    <option value=2>2</option>
                    <option value=3>3</option>
                    <option value=4>4</option>
                    <option value=5>5</option>
                    <option value=6>6</option>
                    <option value=7>7</option>
                    <option value=8>8</option>
                    <option value=9>9</option>
                    <option value=10>10</option>
                    <option value=11>11</option>
                    <option selected value=12>12</option>
                    <option value=13>13</option>
                    <option value=14>14</option>
                    <option value=15>15</option>
                    <option value=16>16</option>
                    <option value=17>17</option>
                    <option value=18>18</option>
                    <option value=19>19</option>
                    <option value=20>20</option>
                    <option value=21>21</option>
                    <option value=22>22</option>
                    <option value=23>23</option>
                    <option value=24>24</option>
                    <!-- <option value=13>13</option>
                    <option value=14>14</option>
                    <option value=15>15</option>
                    <option value=16>16</option>
                    <option value=17>17</option>
                    <option value=18>18</option>
                    <option value=19>19</option>
                    <option value=20>20</option> -->
                  </h3>
                </select>
                <!-- <h3 style="display:inline;color:green;">ניסיון</h3> -->
                <h3 style="display:inline;color:blue;">הכפלה:</h3>

                <select id="periodSelect" onchange="periodChangeFunction()">
                    <h3 >
                      <option selected="selected" value=1>1</option>
                      <option value=2>2</option>
                      <option value=3>3</option>
                      <option value=4>4</option>
                      <option value=5>5</option>
                      <option value=6>6</option>
                      <option value=7>7</option>
                      <option value=8>8</option>
                      <option value=9>9</option>
                      <option value=10>10</option>
                      <option value=11>11</option>
                      <option value=12>12</option>
                    </h3>
                  </select>

                <input type="checkbox" id="checkAlldata" value="all" onclick="allDataFunc()">
                <h3 style="display:inline;color:green;">הכל</h3>


                <p id="demo"></p>


               </div>


            </div>


          </div>
          <!-- XXXXXXXXXXXXXXXXXXXXXX -->
          <div id="Charts" class="row">
            <div  class="col-lg-12 boxy" >



              <div id="testreduce" style="max-width:1200px;max-height:400px;"></div>
              <div id="bar_in_exp_Plot" style="max-width:1200px;max-height:400px;"></div>
              <div id="test" style="max-width:1200px;max-height:400px;"></div>
              <div id="bar_savings_loans" style="max-width:1200px;max-height:400px;"></div>



            </div>
          </div>
          <!-- XXXXXXXXXXXXXXXXXXXXXX -->
          <div id="inAndExpRow" class="row">
            <div id="inTable" class="col-lg-6  boxy" >
              <h2>Income Data Table</h2>
              <select id="incomesRecords" onchange="incomesRecordsChangeFunction()">
                  <h3 >
                  </h3>
              </select>
              <p class="saverecdatacss" id="incomerecdata"></p>
              <div id ="incomeselectchart" style="max-width:1200px;max-height:400px;"></div>

              <div class="div_table_wrapper">
                <table border="1" class="dataframe table table-striped table-bordered table-responsivek" id="tInTableJs">
                </table>
              </div>


            </div>

            <div id="expTable" class="col-lg-6   boxy" >
              <h2>Expanse Data Table</h2>


              <select id="expansesRecords" onchange="expansesRecordsChangeFunction()">
                  <h3 >
                  </h3>
              </select>
              <p class="saverecdatacss" id="expanserecdata"></p>
              <div id ="expanseselectchart" style="max-width:1200px;max-height:400px;"></div>

              <div class="div_table_wrapper">
                <table border="1" class="dataframe table table-striped table-bordered table-responsivek" id="tExpTableJs">
                </table>
              </div>





            </div>
          </div>
          <div id="Balance" class="row">
            <div id="balanceTable" class="col-lg-12  boxy" >
              <h2>Balance</h2>

            </div>

          </div>

          <div id="savAndLoanRow" class="row">
            <div id="saveTable" class="col-lg-6 boxy" >
              <h2>Savings Data Table</h2>
              <select id="savingsRecords" onchange="savingsRecordsChangeFunction()">
                  <h3 >

                  </h3>
              </select>
              <p class="saverecdatacss" id="recdata"></p>
              <div id ="savingselectchart" style="max-width:1200px;max-height:400px;"></div>
              <p></p>
              <!-- <div class="div_table_wrapper">
                {{SaveTable|safe}}
              </div> -->
              <div class="div_table_wrapper">
                <table border="1" class="dataframe table table-striped table-bordered table-responsivek" id="tSaveTableJs">
                </table>
              </div>
            </div>

            <div id="loanTable" class="col-lg-6 boxy" >
              <h2>Loans Data Table</h2>
              <select id="loansRecords" onchange="loansRecordsChangeFunction()">
                  <h3 >
                  </h3>
              </select>
              <p class="saverecdatacss" id="loanrecdata"></p>
              <div id ="loanselectchart" style="max-width:1200px;max-height:400px;"></div>
              <p></p>
              <!-- <div class="div_table_wrapper">
                {{LoanTable|safe}}
              </div> -->
              <div class="div_table_wrapper">
                <table border="1" class="dataframe table table-striped table-bordered table-responsivek" id="tLoanTableJs">
                </table>
              </div>
            </div>

          </div>
          <!-- for space at bottom of page -->
          <p></p>
          <p></p>
          <!-- *********** -->

          <!-- *********** -->
        </div>
        <div id="twoSlotsData" class="col-lg-2 boxy" >
            <h1>Future Event Planning</h1>
            <label>Select Date:</label>
            <input type="date" id="currentDate" onchange="CurrentDateChane()">

            <label> Incomes At Date:</label>
            <label id="InAtDate" style="color:blue"></label>

            <label> Expanses At Date:</label>
            <label id="ExpansesAtDate" style="color:blue"></label>

            <label> Ballance At Date:</label>
            <label id="BallanceAtDate" style="color:Maroon;font-weight: bold"></label>

            <label> Savings At Date:</label>
            <label id="SavingsAtDate" style="color:blue"></label>

            <label> Loans At Date:</label>
            <label id="LoansAtDate" style="color:blue"></label>

            <label> Hon Ballance At Date:</label>
            <label id="HonBallanceAtDate" style="color:Maroon;font-weight: bold"></label><br><br>

            <!-- record parameters to add -->
            <label style="color:green;font-weight: bold">Event Parameters:</label><br>
            <label>Event name:</label> <input type="text" id="ename" value="Event_Name"><br>
            <label>Event Cost:</label> <input type="number" id="ecost" value=10000><br>


            <label style="color:blue;font-weight: bold">Add Simulated Record:</label><br>

            <label>Record name:</label> <input type="text" id="rname" value="Name"><br>

            <label>Record Type:</label><br>
            <select id="rselect" >
              <h3 >
                <option value=1>"Income"</option>
                <option value=2>"Expanse"</option>
                <option value=3>"Saving"</option>
                <option value=4>"Loan"</option>
              </h3><br>
            </select>

            <label>Record Start Date:</label> <input type="text" id="rstartdate" value="07 2021"><br>

            <label>Record End Date:</label> <input type="text" id="renddate" value="07 2022"><br>

            <label>Record Month Value:</label> <input type="number" id="rvalue" value=1000><br>

            <label>Record Start Value:</label> <input type="number" id="rstartvalue" value=5000><br>

            <label>Record Rate:</label> <input type="number" id="rrate" value=1><br><br>



            <!-- <input type="submit" value="Press To Add Record" onclick="addSimulatedRecord()"><br><br> -->
            <button class="open-button" onclick="addSimulatedRecord()">Add</button>

            <label style="color:brown;font-weight: bold">Edit/Delete Record:</label><br>

            <label>Records list:</label><br>
            <select id="rselectdelete" >
              <h3 >

              </h3>
            </select>
            <br><br>

            <button class="open-button" onclick="editRecord()" id="EditRecBut">Edit</button>
            <button class="open-button" onclick="deleteSimulatedRecord()" id="DeleteRecBut">Delete</button>
            <br><br>
            <div class="form-popup" id="myForm">
              <form  class="form-container">
                <h1>Edit</h1>

                <label style="color:blue">Record Name:</label><br>
                <label id="EditRecordname" style="color:blue"></label><br>

                <label>Start Date:</label> <input type="text" id="poprstartdate" value="07 2027"><br>

                <label>End Date:</label> <input type="text" id="poprenddate" value="07 2022"><br>

                <label>Month Value:</label> <input type="number" id="poprvalue" value=1000><br>

                <label>Start Value:</label> <input type="number" id="poprstartvalue" value=5000><br>

                <label>Rate:</label> <input type="number" id="poprrate" value=1><br>

                <button type="button"  onclick="updateRecord()">Update</button>
                <button type="button"  onclick="exitEdit()">Exit</button>
              </form>
            </div>






        </div>
      </div>
    </div>
    <!-- <h1>Charts</h1>
    <div id="myPlot" style="max-width:600px;max-height:400px;"></div> -->


<script>

function editRecord() {

  var select = document.getElementById('rselectdelete');
  document.getElementById("EditRecordname").innerHTML=select.options[select.selectedIndex].text

  document.getElementById("myForm").style.display = "block"


  document.getElementById("EditRecBut").style.display="none"
  document.getElementById("DeleteRecBut").style.display="none"

  //search global sim records for the desired record to be edit
  var found = -1;
  for(var i=0; i<GlobalSimRecords.length; i++)
  {
    if(GlobalSimRecords[i].Rec_Name == select.options[select.selectedIndex].text)
    {
      // __FOUND is set to the index of the element
      found = i;
      break;
    }
  }

  RecordToEdit = GlobalSimRecords.slice(i,i+1)

  console.log(RecordToEdit,RecordToEdit[0].Start_Date,document.getElementById("rstartdate").value)

  // update field of the for for edit the record
  document.getElementById("poprstartdate").value =RecordToEdit[0].Start_Date
  document.getElementById("poprenddate").value =RecordToEdit[0].End_Date
  document.getElementById("poprvalue").value =RecordToEdit[0].Value
  document.getElementById("poprstartvalue").value =RecordToEdit[0].Start_Value
  document.getElementById("poprrate").value =RecordToEdit[0].Rate
}

function exitEdit() {
  document.getElementById("myForm").style.display = "none";

  document.getElementById("EditRecBut").style.display="inline"
  document.getElementById("DeleteRecBut").style.display="inline"

}
function updateRecord()
{

  //find index of record based on name in global sim rec list
  var found = -1;
  for(var i=0; i<GlobalSimRecords.length; i++)
  {
    console.log("i,global_i_name,search_name",i,GlobalSimRecords[i].Rec_Name,document.getElementById("EditRecordname").innerHTML)
    if(GlobalSimRecords[i].Rec_Name == document.getElementById("EditRecordname").innerHTML)
    {
      // __FOUND is set to the index of the element
      found = i;
      break;
    }
  }
  OriginalRecord = GlobalSimRecords.slice(i,i+1)

  console.log(i,OriginalRecord[0])

  // build record from edit parameters
  const NewSimRecord = {Rec_Type:     OriginalRecord[0].Rec_Type.toString(),
                        End_Date:     document.getElementById("poprenddate").value,
                        Start_Date:   document.getElementById("poprstartdate").value,
                        Value:        parseFloat(document.getElementById("poprvalue").value),
                        Start_Value:  document.getElementById("poprstartvalue").value ,
                        Rate:         parseFloat(document.getElementById("poprrate").value),
                        Family_id:    OriginalRecord[0].Family_id,
                        Rec_Name:     OriginalRecord[0].Rec_Name
                        };

  console.log("updated rec",NewSimRecord)
  console.log("original list",GlobalSimRecords)
  console.log("until rec,after rec",GlobalSimRecords.slice(0,i),GlobalSimRecords.slice(i+1,GlobalSimRecords.length))

  GlobalSimRecords= GlobalSimRecords.slice(0,i).concat(NewSimRecord).concat(GlobalSimRecords.slice(i+1,GlobalSimRecords.length));
  console.log("updated list",GlobalSimRecords)

  document.getElementById("myForm").style.display = "none";
  document.getElementById("EditRecBut").style.display="inline"
  document.getElementById("DeleteRecBut").style.display="inline"
  periodChangeFunction()


  //replace old record with updated record
  // update UI

}




document.getElementById("new_reocrd_nav").style.display = "none"
document.getElementById("del_reocrd_nav").style.display = "none"
document.getElementById("edit_reocrd_nav").style.display = "none"
document.getElementById("new_event_nav").style.display = "none"

// data from the view for incomes records
var IncomesRecordsList={{IncomesRecordList|safe}}
var incomesRecordNumber=IncomesRecordsList.length

// data from the view for expanses records
var ExpansesRecordsList={{ExpansesRecordList|safe}}
var expansesRecordNumber=ExpansesRecordsList.length

// data from the view for savingd records
var SavingsRecordsList={{SavingsRecordList|safe}}
var savingsRecordNumber=SavingsRecordsList.length

// data from the view for loans records
var LoansRecordsList={{LoansRecordList|safe}}
var loansRecordNumber=LoansRecordsList.length

var GlobalX=[]
var GlobalIncomes=[]
var GlobalExpanses=[]
var GlobalBallance=[]
var GlobalSavings=[]
var GlobalLoans=[]
var GlobalHonBallance=[]
var GlobalCounter=0
var GlobalOldBalanceArray=[]
var GlobalOldHonBalanceArray=[]

var GlobalSimRecords=[]

function addSimulatedRecord()
{
  var SimEventName = document.getElementById('ename')

  var SimRecordType = document.getElementById('rselect')
  var SimRecordValue = document.getElementById('rvalue')
  var SimRecordStartValue = document.getElementById('rstartvalue')
  var SimRecordRate = document.getElementById('rrate')
  var SimRecordStartDate = document.getElementById('rstartdate')
  var SimRecordEndDate = document.getElementById('renddate')
  var SimRecordName = document.getElementById('rname')

  DateNow = Date.now();
  const NewSimRecord = {Rec_Type:     SimRecordType.value.toString(),
                        End_Date:     SimRecordEndDate.value,
                        Start_Date:   SimRecordStartDate.value,
                        Value:        parseInt(SimRecordValue.value),
                        Start_Value:  parseInt(SimRecordStartValue.value) ,
                        Rate:         parseInt(SimRecordRate.value),
                        Family_id:    IncomesRecordsList[0].Family_id,
                        Rec_Name:     SimRecordName.value.concat("_".concat(DateNow.toString()))
                        };

  GlobalSimRecords.push(NewSimRecord)

  //update select after add
  var select = document.getElementById('rselectdelete');
  select.innerHTML=""

  var array_length=GlobalSimRecords.length
  for (var i = 0; i<array_length; i++)
  {
    var opt = document.createElement('option');
    opt.value = i.toString();
    opt.innerHTML = GlobalSimRecords[i].Rec_Name;
    select.appendChild(opt);
  }

  periodChangeFunction()

}

function deleteSimulatedRecord(){

  var RecordSelectDelete = document.getElementById('rselectdelete')

  var found = -1;
  for(var i=0; i<GlobalSimRecords.length; i++)
  {
    if(GlobalSimRecords[i].Rec_Name == RecordSelectDelete.options[RecordSelectDelete.selectedIndex].text)
    {
      // __FOUND is set to the index of the element
      found = i;
      break;
    }
  }

  //delete element
  GlobalSimRecords= GlobalSimRecords.slice(0,found).concat(GlobalSimRecords.slice(found+1,GlobalSimRecords.length));

  //update select after delete
  var select = document.getElementById('rselectdelete');
  select.innerHTML=""
  var array_length=GlobalSimRecords.length
  for (var i = 0; i<array_length; i++)
  {
    var opt = document.createElement('option');
    opt.value = i.toString();
    opt.innerHTML = GlobalSimRecords[i].Rec_Name;
    select.appendChild(opt);
  }

  periodChangeFunction()

}

// in summary area date is changed
function CurrentDateChane(){
  var DateToSearch=""
  var CurrentDate = document.getElementById('currentDate')
  SelectedDate = new Date(CurrentDate.value)

  SelectedMonth =SelectedDate.getMonth()
  SelectedMonth=SelectedMonth+1//function start january=0
  SelectedYear = SelectedDate.getFullYear()


  if (SelectedMonth<10){
    SelectedMonthString = "0".concat(SelectedMonth.toString())
  }
    else
        {
          SelectedMonthString = SelectedMonth.toString()
        }

  DateToSearch = DateToSearch.concat(SelectedYear.toString(),"-",SelectedMonthString)

  // find index of selected date
  for (j = 1; j <= GlobalX.length; j=j+1)
  {
    if(GlobalX[j]==DateToSearch)
    {
        // console.log(GlobalX[j],DateToSearch,j)
        break
    }
  }

  document.getElementById('InAtDate').innerHTML=GlobalIncomes[j]
  document.getElementById('ExpansesAtDate').innerHTML=GlobalExpanses[j]
  document.getElementById('BallanceAtDate').innerHTML=GlobalBallance[j]

  document.getElementById('SavingsAtDate').innerHTML=GlobalSavings[j]
  document.getElementById('LoansAtDate').innerHTML=GlobalLoans[j]
  document.getElementById('HonBallanceAtDate').innerHTML=GlobalHonBallance[j]

}

function BuildSelectsNamesList(){

  // get names of incomes records
  SimRecordsIn=filterRecordsListByType(GlobalSimRecords,"1")
  JoinedArrayOfIncomesRecords=IncomesRecordsList.concat(SimRecordsIn)

  var incomesRecordsNames = []
    for (var i = 0; i<JoinedArrayOfIncomesRecords.length; i++)
      incomesRecordsNames.push(JoinedArrayOfIncomesRecords[i].Rec_Name);

  // inserts incomes record names into list of select
  var select = document.getElementById('incomesRecords');
  select.innerHTML=""

  var array_length=incomesRecordsNames.length
  for (var i = 0; i<array_length; i++)
  {
    var opt = document.createElement('option');
    opt.value = i.toString();
    opt.innerHTML = incomesRecordsNames[i];
    select.appendChild(opt);
  }


  // get names of expanses records
  SimRecordsExp=filterRecordsListByType(GlobalSimRecords,"2")
  JoinedArrayOfExpansesRecords=ExpansesRecordsList.concat(SimRecordsExp)

  var expansesRecordsNames = []
  for (var i = 0; i<JoinedArrayOfExpansesRecords.length; i++)
    expansesRecordsNames.push(JoinedArrayOfExpansesRecords[i].Rec_Name);

  // inserts expanse record names into list of select
  var select = document.getElementById('expansesRecords');
  select.innerHTML=""
  var array_length=expansesRecordsNames.length
  for (var i = 0; i<array_length; i++)
  {
    var opt = document.createElement('option');
    opt.value = i.toString();
    opt.innerHTML = expansesRecordsNames[i];
    select.appendChild(opt);
  }

  // get names of savings records

  SimRecordsSavings=filterRecordsListByType(GlobalSimRecords,"3")
  JoinedArrayOfSavingsRecords=SavingsRecordsList.concat(SimRecordsSavings)

  var savingsRecordsNames = []
  for (var i = 0; i<JoinedArrayOfSavingsRecords.length; i++)
    savingsRecordsNames.push(JoinedArrayOfSavingsRecords[i].Rec_Name);

  // inserts savings record names into list of select
  var select = document.getElementById('savingsRecords');
  select.innerHTML=""
  var array_length=savingsRecordsNames.length
  for (var i = 0; i<array_length; i++)
  {
    var opt = document.createElement('option');
    opt.value = i.toString();
    opt.innerHTML = savingsRecordsNames[i];
    select.appendChild(opt);
  }


  // get names of loans records

  SimRecordsLoans=filterRecordsListByType(GlobalSimRecords,"4")
  JoinedArrayOfLoansRecords=LoansRecordsList.concat(SimRecordsLoans)

  var loansRecordsNames = []
  for (var i = 0; i<JoinedArrayOfLoansRecords.length; i++)
    loansRecordsNames.push(JoinedArrayOfLoansRecords[i].Rec_Name);

  // inserts loans record names into list of select
  var select = document.getElementById('loansRecords');
  select.innerHTML=""
  var array_length=loansRecordsNames.length
  for (var i = 0; i<array_length; i++)
  {
    var opt = document.createElement('option');
    opt.value = i.toString();
    opt.innerHTML = loansRecordsNames[i];
    select.appendChild(opt);
  }

}



//call function on change of income select to display the selected record
function incomesRecordsChangeFunction(){

    SimRecordsIn=filterRecordsListByType(GlobalSimRecords,"1")
    JoinedArrayOfIncomesRecords=IncomesRecordsList.concat(SimRecordsIn)

    generalRecordsChangeFunction("tInTableJs","incomesRecords",JoinedArrayOfIncomesRecords,"incomeselectchart","incomerecdata")
}

//call function on change of expanse  select to display the selected record
function expansesRecordsChangeFunction(){

    SimRecordsExp=filterRecordsListByType(GlobalSimRecords,"2")
    JoinedArrayOfIncomesRecords=ExpansesRecordsList.concat(SimRecordsExp)

    generalRecordsChangeFunction("tExpTableJs","expansesRecords",JoinedArrayOfIncomesRecords,"expanseselectchart","expanserecdata")
}

//call function on change of saving select to display the selected record
function savingsRecordsChangeFunction(){
    SimRecordsSavings=filterRecordsListByType(GlobalSimRecords,"3")
    JoinedArrayOfSavingsRecords=SavingsRecordsList.concat(SimRecordsSavings)

    generalRecordsChangeFunction("tSaveTableJs","savingsRecords",JoinedArrayOfSavingsRecords,"savingselectchart","recdata")
}

//call function on change of loan select to display the selected record
function loansRecordsChangeFunction(){
    SimRecordsLoans=filterRecordsListByType(GlobalSimRecords,"4")
    JoinedArrayOfLoansRecords=LoansRecordsList.concat(SimRecordsLoans)
    generalRecordsChangeFunction("tLoanTableJs","loansRecords",JoinedArrayOfLoansRecords,"loanselectchart","loanrecdata")
}

// function to catch select saving record change event to update to the selected record
function generalRecordsChangeFunction(lv_Table,lv_Records,lv_RecordsList,lv_selectchart,lv_recdata){
  // build x axies of the graph
  // all x axies are the same. income here can be any other
  var xArray ={{IncomeXAxies|safe}}
  // saving table id
  var myTab = document.getElementById(lv_Table);
  // saving select id
  var select = document.getElementById(lv_Records);
  // current select value
  var selectValue=select.value

  // LOOP THROUGH EACH ROW OF THE TABLE AFTER HEADER.
  // and stop when the name of the raw same as name of the select.
  // Y axis data is in rawdata list

  for (i = 1; i < myTab.rows.length; i++)
   {
            // console.log("1",myTab.rows.item(i))
            var rawdata = []
            // GET THE CELLS COLLECTION OF THE CURRENT ROW.
            var objCells = myTab.rows.item(i).cells;
            // LOOP THROUGH EACH CELL OF THE CURENT ROW TO READ CELL VALUES.
            for (var j = 0; j < objCells.length; j++) {
                rawdata.push(parseInt(objCells.item(j).innerHTML))
            }

            recName=myTab.rows.item(i).cells.item(0).innerHTML
            rawdata.shift()
            if (recName == select.options[selectValue].text)
            {

              break;
            }
   }


   // update rec data under the select
   for (var j = 0; j < lv_RecordsList.length; j++) {
      if (lv_RecordsList[j].Rec_Name == recName)
      {
        // if loan then dont need the rate and start value to display
        if(lv_RecordsList[j].Rec_Type == "4" || lv_RecordsList[j].Rec_Type == "1"  || lv_RecordsList[j].Rec_Type == "2")
        {
          // document.getElementById('recdata').innerHTML="".concat("Start Date: <em>"" lv_RecordsList[j].Start_Date </em>"
          document.getElementById(lv_recdata).innerHTML="".concat("<em>","start date: ","</em>",lv_RecordsList[j].Start_Date,"<em>"," end Date: ","</em>",lv_RecordsList[j].End_Date,"<em>"," Value: ","</em>",lv_RecordsList[j].Value,"<em>")
        }
        else{
            // document.getElementById('recdata').innerHTML="".concat("Start Date: <em>"" lv_RecordsList[j].Start_Date </em>"
            document.getElementById(lv_recdata).innerHTML="".concat("<em>","start date: ","</em>",lv_RecordsList[j].Start_Date,"<em>"," end Date: ","</em>",lv_RecordsList[j].End_Date,"<em>"," Value: ","</em>",lv_RecordsList[j].Value,"<em>"," Rate: ","</em>",lv_RecordsList[j].Rate,
            "<em>"," Start Value: ","</em>",lv_RecordsList[j].Start_Value)
        }


        break;
      }
    }

   var trace1 ={
            x: xArray,
            y: rawdata,
            marker: {color: 'blue'},
            type: 'scatter',
            name:select.options[selectValue].text
    }

   var layout ={
      xaxis: {autorange: true,title: "Date"},
      yaxis: {autorange: true,title: "Value"},
      title: select.options[selectValue].text,
      // plot_bgcolor:"black",
      paper_bgcolor:"#f4fce3",
      width: 500,
      height: 250,
        margin: {
          l: 50,
          r: 50,
          b: 40,
          t: 80,
          pad: 2
        },

    }
    // var data =[trace1,trace2,trace3,trace4,layout]
   var data =[trace1]

   Plotly.newPlot(lv_selectchart,data,layout);
}


function allDataFunc() {

  var checkBox = document.getElementById("checkAlldata");
  if (checkBox.checked == true){
    document.getElementById("periodSelect").disabled=true
    document.getElementById("typeOfPeriods").disabled=true
    document.getElementById("returns").disabled=true
    periodChangeFunction()
  }else{
    document.getElementById("periodSelect").disabled=false
    document.getElementById("typeOfPeriods").disabled=false
    document.getElementById("returns").disabled=false
  }
}

function monthDiff(dateFrom, dateTo) {
 return dateTo.getMonth() - dateFrom.getMonth() +
   (12 * (dateTo.getFullYear() - dateFrom.getFullYear()))
}


// build table using **js/////////////////////////////////
function buildTableAndTotal(lv_Table_Name,lv_X_Array,lv_Record_List,lv_Records_Type)
{//line 1

  var table = document.getElementById(lv_Table_Name);
  table.innerHTML=""
  var row = table.insertRow(0);
  var cell1 = row.insertCell(0);
  cell1.innerHTML = "";
  // fill in the first raw with the X aaies from view with values(month of the simulation)
  for (i = 1; i <= lv_X_Array.length; i=i+1)
  {//line 3
    cell = row.insertCell(i);
    cell.innerHTML = lv_X_Array[i-1]
  }//\\line 3

  // build raw based on records list from the view
  for (i=0;i<lv_Record_List.length;i=i+1)
  {//line 3
      // insert into first cell of the raw the record name
      row = table.insertRow(i+1);
      cell = row.insertCell(0);
      cell.innerHTML = lv_Record_List[i]['Rec_Name']
      // console.log("name:",lv_Record_List[i]['Rec_Name'])
      // get start and end date of the record
      startDateArr = lv_Record_List[i]['Start_Date'].split(" ");
      StartDateJsFormat=startDateArr[1]+"-"+startDateArr[0]+"-"+"01"
      recStartDate = new Date(StartDateJsFormat)
      endDateArr = lv_Record_List[i]['End_Date'].split(" ");
      EndDateJsFormat=endDateArr[1]+"-"+endDateArr[0]+"-"+"01"
      recEndDate = new Date(EndDateJsFormat)
      recLongInMonth=monthDiff(recStartDate, recEndDate)

      flag=0
      prev=0
      //insert values to the raw cells
      for (j = 1; j <= lv_X_Array.length; j=j+1)
      {//line 7

        //get cell date of the raw
        cellDate=(table.rows[0].cells[j].innerHTML);
        cellDateArr = cellDate.split("-");
        CellDateJsFormat=cellDateArr[0]+"-"+cellDateArr[1]+"-"+"01"
        cellDate = new Date(CellDateJsFormat)
        cell = row.insertCell(j);
        // check if date of the cell is in the record dates
        if((cellDate>=recStartDate)&&(cellDate<=recEndDate))
        {//line 9
          //check if the record is save or loan, In and Exp takes values
          // in oppose to save and loan that calc intrest
          if (lv_Records_Type == "Savings" || lv_Records_Type == "Loans")
          {//line 11
                  if(lv_Records_Type == "Savings")
                  {//line 19
                      if (flag==0)
                      {//line 23
                         prev=lv_Record_List[i]['Value']+lv_Record_List[i]['Start_Value']
                         cell.innerHTML= prev
                         flag=1
                      }//\\line 23
                      else
                          {//line 27
                            current=prev*(1+lv_Record_List[i]['Rate']/12/100)+Math.round(lv_Record_List[i]['Value'])
                            cell.innerHTML= Math.round(current)
                            prev=current
                          }//l\\ine 27
                  }//line 19
                  else
                      {//line 23
                        if(lv_Records_Type == "Loans")
                        {//line 25
                          if (flag==0)
                          {//line 23
                             prev=lv_Record_List[i]['Value']*recLongInMonth
                             // console.log("value,length,prev:",lv_Record_List[i]['Value'],recLongInMonth,prev)
                             // console.log("value,long",lv_Record_List[i]['Value'],recLongInMonth)
                             cell.innerHTML= prev
                             flag=1
                          }
                          else
                          {
                            current=prev-lv_Record_List[i]['Value']
                            // console.log("value,current:",lv_Record_List[i]['Value'],current)
                            cell.innerHTML= Math.round(current)
                            prev=current
                          }//\\line 23

                        }//\\line 25
                        else
                            {//line 29
                              cell.innerHTML= Math.round(-9)
                            }//\\line 29
                      }//\\line 23
          }//\\line 11
          else
              {//line 15
                cell.innerHTML = Math.round(lv_Record_List[i]['Value'])
              }//\\line 15
        }//\\line 9
        else
            {//line 13
              if (lv_Records_Type == "Savings")
              {//line 15
                current=prev*(1+lv_Record_List[i]['Rate']/12/100)
                cell.innerHTML= Math.round(current)
                prev=current
              }//\\line 15
              else
                  {//line 19
                    if (lv_Records_Type == "Loans")
                    {//line 21
                      cell.innerHTML= Math.round(0)
                    }//\\line 21
                    else
                        {//line 25
                          cell.innerHTML = '0'
                        }//\\line 25
                  }//\\line 19
            }//\\line 13
      }//\\line 7
    }//\\line 3

    //calculate the total raw.
    row = table.insertRow(lv_Record_List.length+1);
    cell = row.insertCell(0);
    cell.innerHTML = "Total"

    for (i=1;i<=lv_X_Array.length;i=i+1)
    {
      cell = row.insertCell(i);
      sum=0
      for (j=1;j<lv_Record_List.length+1;j=j+1)
      {
        // console.log(table.rows[j].cells[i].innerHTML)
        val = parseInt(table.rows[j].cells[i].innerHTML)
        sum = sum+val
        cell.innerHTML = sum
      }
    }

    totalRow = table.rows[lv_Record_List.length+1]
    var yArrayJsTable=[]
    for (i = 1; i <= lv_X_Array.length; i=i+1)
    {
      intValue=parseInt(totalRow.cells[i].innerHTML)
      yArrayJsTable.push(intValue)
    }
    return yArrayJsTable

}
function filterRecordsListByType(l_in_list,type)
{
    // console.log("filter:",l_in_list)
    resList=[]
    if(l_in_list.length != 0)
    {
      for(i = 0;i<l_in_list.length;i++)
      {
        // console.log("if:",l_in_list[i].Rec_Type.toString(), type)
        if(l_in_list[i].Rec_Type.toString() == type)
          resList.push(l_in_list[i])
      }
    }

    return resList

}
//////////////////////////////////////////////////////////
window.onload = periodChangeFunction;
function periodChangeFunction(){
  // IncomesRecordsList[0].Value=37000
  var xArray ={{IncomeXAxies|safe}}
  var ExpxArray ={{ExpXAxies|safe}}
  var BalancexArray ={{BalanceXAxies|safe}}
  var SavingxArray ={{SavingsXAxies|safe}}
  var LoanxArray ={{LoansXAxies|safe}}

  BuildSelectsNamesList()

  // update table using **js/////////////////////////////////
  SimRecordsIn=filterRecordsListByType(GlobalSimRecords,"1")
  yArray = buildTableAndTotal("tInTableJs",xArray,IncomesRecordsList.concat(SimRecordsIn),"In")
  incomesRecordsChangeFunction()

  SimRecordsExp=filterRecordsListByType(GlobalSimRecords,"2")
  ExpyArray = buildTableAndTotal("tExpTableJs",xArray,ExpansesRecordsList.concat(SimRecordsExp),"Exp")
  expansesRecordsChangeFunction()

  BalanceyArray = [];
  BalanceyArray[0]=yArray[0] - ExpyArray[0]
  for(i = 1;i<=yArray.length;i++){
     BalanceyArray[i]=BalanceyArray[i-1]+(yArray[i] - ExpyArray[i])
  }



  SimRecordsSavings=filterRecordsListByType(GlobalSimRecords,"3")
  SavingyArray = buildTableAndTotal("tSaveTableJs",xArray,SavingsRecordsList.concat(SimRecordsSavings),"Savings")
  savingsRecordsChangeFunction()


  SimRecordsLoans=filterRecordsListByType(GlobalSimRecords,"4")
  LoanyArray = buildTableAndTotal("tLoanTableJs",xArray,LoansRecordsList.concat(SimRecordsLoans),"Loans")
  loansRecordsChangeFunction()

  HonBalanceyArray = [];
  HonBalanceyArray[0]=SavingyArray[0] - LoanyArray[0]
  for(i = 1;i<=SavingyArray.length;i++){
     HonBalanceyArray[i]=(SavingyArray[i] - LoanyArray[i])
  }

  // save the ballance and hon ballance when page loaded first time
  if(GlobalCounter==0)
  {
      GlobalOldBalanceArray=BalanceyArray
      GlobalOldHonBalanceArray=HonBalanceyArray
      GlobalCounter=1
  }

 // save values for the summary section that uses them
 GlobalX=xArray
 GlobalIncomes=yArray
 GlobalExpanses=ExpyArray
 GlobalBallance=BalanceyArray
 GlobalSavings=SavingyArray
 GlobalLoans=LoanyArray
 GlobalHonBallance=HonBalanceyArray
  ////////////////////////////////////////////////////////////

  var periods = document.getElementById("periodSelect").value;
  var typeofperiods = document.getElementById("typeOfPeriods").value;
  var returns = document.getElementById("returns").value;
  var NomOfMonToRet=periods*typeofperiods
  var MaxMonthIndex = NomOfMonToRet*returns

  //reduce arrays per user request of display months
  var xArrayReduced = [];
  var yArrayReduced = [];
  var ExpxArrayReduced  = [];
  var ExpyArrayReduced  = [];
  var BalancexArrayReduced = [];
  var BalanceyArrayReduced = [];

  var GlobalOldBalanceArrayReduced =[];
  var GlobalOldHonBalanceArrayReduced=[]

  var HonBalancexArrayReduced= [];
  var HonBalanceyArrayReduced= [];

  var SavingxArrayReduced = [];
  var SavingyArrayReduced = [];
  var LoanxArrayReduced = [];
  var LoanyArrayReduced = [];

  checkBox = document.getElementById("checkAlldata");
  if (checkBox.checked == false)
    {
      if (MaxMonthIndex > xArray.length)
      {
        MaxMonthIndex = xArray.length;
      }
      for (i = 0; i <= MaxMonthIndex; i=i+NomOfMonToRet) {
        xArrayReduced.push(xArray[i]);
        yArrayReduced.push(yArray[i]);
        ExpxArrayReduced.push(ExpxArray[i]);
        ExpyArrayReduced.push(ExpyArray[i]);
        BalancexArrayReduced.push(BalancexArray[i]);
        BalanceyArrayReduced.push(BalanceyArray[i]);

        GlobalOldBalanceArrayReduced.push(GlobalOldBalanceArray[i]);
        GlobalOldHonBalanceArrayReduced.push(GlobalOldHonBalanceArray[i]);

        HonBalancexArrayReduced.push(BalancexArray[i]);
        HonBalanceyArrayReduced.push(HonBalanceyArray[i]);


        SavingxArrayReduced.push(SavingxArray[i]);
        SavingyArrayReduced.push(SavingyArray[i]);
        LoanxArrayReduced.push(LoanxArray[i]);
        LoanyArrayReduced.push(LoanyArray[i]);
        // console.log(NomOfMonToRet,MaxMonthIndex,)
        // console.log(i,xArray[i],xArrayReduced[i])
      }

    }
    else{
      xArrayReduced=xArray
      yArrayReduced=yArray
      ExpxArrayReduced=ExpxArray
      ExpyArrayReduced=ExpyArray
      BalancexArrayReduced=BalancexArray
      BalanceyArrayReduced=BalanceyArray

      GlobalOldBalanceArrayReduced=GlobalOldBalanceArray
      GlobalOldHonBalanceArrayReduced=GlobalOldHonBalanceArray

      HonBalancexArrayReduced=BalancexArray
      HonBalanceyArrayReduced=HonBalanceyArray

      SavingxArrayReduced=SavingxArray
      SavingyArrayReduced=SavingyArray
      LoanxArrayReduced = LoanxArray
      LoanyArrayReduced = LoanyArray
    }

///////////////////////////////////////////



    var trace1 ={
      x: xArrayReduced,
      y: yArrayReduced,
      marker: {color: 'green'},
      type: 'bar',
      name:"Incomes"

    }

    var trace2 ={
      x: ExpxArrayReduced,
      y: ExpyArrayReduced,
      marker: {color: 'red'},
      type: 'bar',
      name:"Expanses"

    }

    var trace3 ={
      x: BalancexArrayReduced,
      y: BalanceyArrayReduced,
      marker: {color: 'blue'},
      type: 'scatter',
      name:"Balance",
    }

    var trace4 ={
      x: BalancexArrayReduced,
      y: GlobalOldBalanceArrayReduced,
      marker: {color: 'black'},
      type: 'scatter',
      name:"Referance Balance",
    }



    var layout ={
      xaxis: {autorange: true,title: "Date",range: [ExpxArray[0],ExpxArray[36]]},
      yaxis: {autorange: true,title: "Value"},
      title: "Income,Expanse and Ballance",
      // plot_bgcolor:"black",
      paper_bgcolor:"#f4fce3",

      }
    // var data =[trace1,trace2,trace3,trace4,layout]
    var data =[trace1,trace2,trace3,trace4]

    Plotly.newPlot('bar_in_exp_Plot',data,layout);


///////////////////////////////////////////////////////////

    // Define Data
    var trace1 ={
      x: SavingxArrayReduced,
      y: SavingyArrayReduced,
      marker: {color: 'green'},
      type: 'bar',
      name:"Savings"
    }
    // Define Layout

    var trace2 ={
      x: LoanxArrayReduced,
      y: LoanyArrayReduced,
      marker: {color: 'red'},
      type: 'bar',
      name:"Loans"

    }

    var trace3 ={

      x: HonBalancexArrayReduced,
      y: HonBalanceyArrayReduced,
      marker: {color: 'blue'},
      type: 'scatter',
      name:"Hon Balance",


    }

    var trace4 ={
      x: HonBalancexArrayReduced,
      y: GlobalOldHonBalanceArrayReduced,
      marker: {color: 'black'},
      type: 'scatter',
      name:"Referance Hon Balance",
    }



    var layout ={
      xaxis: {autorange: true,title: "Date"},
      yaxis: {autorange: true,title: "Value"},
      title: "Saving and Loans",
      // plot_bgcolor:"black",
      paper_bgcolor:"#93a2ba",

      }
    // var data =[trace1,trace2,trace3,trace4,layout]
    var data =[trace1,trace2,trace3,trace4]
    Plotly.newPlot('bar_savings_loans',data,layout);

    CurrentDateChane()

}
// incomesRecordsChangeFunction()
// expansesRecordsChangeFunction()
// savingsRecordsChangeFunction()
//loansRecordsChangeFunction()

// function showTableData() {
//      document.getElementById('info').innerHTML = "";
//      var myTab = document.getElementById('empTable');
//
//      // LOOP THROUGH EACH ROW OF THE TABLE AFTER HEADER.
//      for (i = 1; i < myTab.rows.length; i++) {
//
//          // GET THE CELLS COLLECTION OF THE CURRENT ROW.
//          var objCells = myTab.rows.item(i).cells;
//
//          // LOOP THROUGH EACH CELL OF THE CURENT ROW TO READ CELL VALUES.
//          for (var j = 0; j < objCells.length; j++) {
//              info.innerHTML = info.innerHTML + ' ' + objCells.item(j).innerHTML;
//          }
//          info.innerHTML = info.innerHTML + '<br />';     // ADD A BREAK (TAG).
//      }
//  }

  </script>


    </body>
  </html>

    {% endblock %}
